<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Cops vs Robbers: rtos/os.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Cops vs Robbers
   </div>
   <div id="projectbrief">AVR code to run a game of cops and robbers on 4 iRobot Create 2s</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d7/dea/os_8c.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">os.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A Real Time Operating System.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;avr/io.h&gt;</code><br />
<code>#include &lt;avr/interrupt.h&gt;</code><br />
<code>#include &lt;util/delay.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d0/dff/os_8h_source.html">os.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/daa/kernel_8h_source.html">kernel.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/daa/error__code_8h_source.html">error_code.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d26/port__map_8h_source.html">port_map.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a13f1ce8d1aeefce0b0d42cc7bad81fa1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a13f1ce8d1aeefce0b0d42cc7bad81fa1">USE_AVR2560_GREATER</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a13f1ce8d1aeefce0b0d42cc7bad81fa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc80b18f37f24eb0f8bc27ca56e65d4b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#adc80b18f37f24eb0f8bc27ca56e65d4b">STACKCONTEXTSIZE</a>&#160;&#160;&#160;(32 + 1 + 1 + 3 + 3)</td></tr>
<tr class="separator:adc80b18f37f24eb0f8bc27ca56e65d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ca901a3c767870093be57d271afc51e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a4ca901a3c767870093be57d271afc51e">KERNELARG_STACKOFFSET</a>&#160;&#160;&#160;(32 + 1 + 1 + 1)</td></tr>
<tr class="separator:a4ca901a3c767870093be57d271afc51e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8ed78dfc7cf1438e51909e988a8e6aa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#ac8ed78dfc7cf1438e51909e988a8e6aa">SAVE_CTX_TOP</a>()</td></tr>
<tr class="separator:ac8ed78dfc7cf1438e51909e988a8e6aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adadefdf0cfb4066c6439cd200093c456"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#adadefdf0cfb4066c6439cd200093c456">STACK_SREG_SET_I_BIT</a>()</td></tr>
<tr class="separator:adadefdf0cfb4066c6439cd200093c456"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9250d18ad0a0ff5171eed2dc5f4e18d4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a9250d18ad0a0ff5171eed2dc5f4e18d4">SAVE_CTX_BOTTOM</a>()</td></tr>
<tr class="separator:a9250d18ad0a0ff5171eed2dc5f4e18d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad70a92eee8278b45f6aad877e23e0d3f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#ad70a92eee8278b45f6aad877e23e0d3f">SAVE_CTX</a>()&#160;&#160;&#160;<a class="el" href="../../d7/dea/os_8c.html#ac8ed78dfc7cf1438e51909e988a8e6aa">SAVE_CTX_TOP</a>();<a class="el" href="../../d7/dea/os_8c.html#a9250d18ad0a0ff5171eed2dc5f4e18d4">SAVE_CTX_BOTTOM</a>();</td></tr>
<tr class="memdesc:ad70a92eee8278b45f6aad877e23e0d3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push all the registers and SREG onto the stack.  <a href="#ad70a92eee8278b45f6aad877e23e0d3f">More...</a><br /></td></tr>
<tr class="separator:ad70a92eee8278b45f6aad877e23e0d3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6002f8099b24e6c7903df21a754f1d6b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a6002f8099b24e6c7903df21a754f1d6b">RESTORE_CTX_BOTTOM</a>()</td></tr>
<tr class="separator:a6002f8099b24e6c7903df21a754f1d6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac79aff233b9171c3cacaf6ddffe8014a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#ac79aff233b9171c3cacaf6ddffe8014a">RESTORE_CTX_TOP</a>()</td></tr>
<tr class="separator:ac79aff233b9171c3cacaf6ddffe8014a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa48fc0927da8c8abbe88e67573b389c9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#aa48fc0927da8c8abbe88e67573b389c9">RESTORE_CTX</a>()&#160;&#160;&#160;<a class="el" href="../../d7/dea/os_8c.html#a6002f8099b24e6c7903df21a754f1d6b">RESTORE_CTX_BOTTOM</a>();<a class="el" href="../../d7/dea/os_8c.html#ac79aff233b9171c3cacaf6ddffe8014a">RESTORE_CTX_TOP</a>();</td></tr>
<tr class="memdesc:aa48fc0927da8c8abbe88e67573b389c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pop all registers and the status register.  <a href="#aa48fc0927da8c8abbe88e67573b389c9">More...</a><br /></td></tr>
<tr class="separator:aa48fc0927da8c8abbe88e67573b389c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:afff05d20e8e3bfc1d7d8aab2bb3a1e9b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#afff05d20e8e3bfc1d7d8aab2bb3a1e9b">r_main</a> ()</td></tr>
<tr class="memdesc:afff05d20e8e3bfc1d7d8aab2bb3a1e9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">main function provided by user application. The first task to run.  <a href="#afff05d20e8e3bfc1d7d8aab2bb3a1e9b">More...</a><br /></td></tr>
<tr class="separator:afff05d20e8e3bfc1d7d8aab2bb3a1e9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5bea28826fceb06503c295132d2ac03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#aa5bea28826fceb06503c295132d2ac03">TIMER1_COMPA_vect</a> (void)</td></tr>
<tr class="memdesc:aa5bea28826fceb06503c295132d2ac03"><td class="mdescLeft">&#160;</td><td class="mdescRight">The interrupt handler for output compare interrupts on Timer 1.  <a href="#aa5bea28826fceb06503c295132d2ac03">More...</a><br /></td></tr>
<tr class="separator:aa5bea28826fceb06503c295132d2ac03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b0393958dca633b459633385794d39b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/dff/os_8h.html#a26849fee1aa8a05562ee7a577e991fc8">service_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a1b0393958dca633b459633385794d39b">Service_Init</a> ()</td></tr>
<tr class="separator:a1b0393958dca633b459633385794d39b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee597502c326bc9ca1faeaa422dbbbf8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#aee597502c326bc9ca1faeaa422dbbbf8">Service_Subscribe</a> (<a class="el" href="../../d0/dff/os_8h.html#a26849fee1aa8a05562ee7a577e991fc8">service_t</a> *s, int16_t *v)</td></tr>
<tr class="separator:aee597502c326bc9ca1faeaa422dbbbf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa4dbf5e4da2f0aba1fff3b057e79389"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#aaa4dbf5e4da2f0aba1fff3b057e79389">Service_Publish</a> (<a class="el" href="../../d0/dff/os_8h.html#a26849fee1aa8a05562ee7a577e991fc8">service_t</a> *s, int16_t v)</td></tr>
<tr class="separator:aaa4dbf5e4da2f0aba1fff3b057e79389"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a280149a9407c6504ce0af541351561db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a280149a9407c6504ce0af541351561db">OS_Init</a> ()</td></tr>
<tr class="memdesc:a280149a9407c6504ce0af541351561db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the RTOS and create <a class="el" href="../../d7/dea/os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a> as the first SYSTEM level task.  <a href="#a280149a9407c6504ce0af541351561db">More...</a><br /></td></tr>
<tr class="separator:a280149a9407c6504ce0af541351561db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af421581f2b3d36a5ac9a205e035ae172"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#af421581f2b3d36a5ac9a205e035ae172">Now</a> ()</td></tr>
<tr class="separator:af421581f2b3d36a5ac9a205e035ae172"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5747390a8be675282cb93e5198bd085"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#ab5747390a8be675282cb93e5198bd085">OS_Abort</a> (void)</td></tr>
<tr class="memdesc:ab5747390a8be675282cb93e5198bd085"><td class="mdescLeft">&#160;</td><td class="mdescRight">Abort the execution of this RTOS due to an unrecoverable erorr.  <a href="#ab5747390a8be675282cb93e5198bd085">More...</a><br /></td></tr>
<tr class="separator:ab5747390a8be675282cb93e5198bd085"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dc6b10ee85f46900bc8ed99225f4425"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a2dc6b10ee85f46900bc8ed99225f4425">Task_Create_System</a> (void(*f)(void), int16_t arg)</td></tr>
<tr class="separator:a2dc6b10ee85f46900bc8ed99225f4425"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfffed5dc80a63a8436cc49d61e92cb7"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#abfffed5dc80a63a8436cc49d61e92cb7">Task_Create_RR</a> (void(*f)(void), int16_t arg)</td></tr>
<tr class="separator:abfffed5dc80a63a8436cc49d61e92cb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a369e92f3f8ffc2042e061bd2a64a0f8f"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a369e92f3f8ffc2042e061bd2a64a0f8f">Task_Create_Periodic</a> (void(*f)(void), int16_t arg, uint16_t period, uint16_t wcet, uint16_t start)</td></tr>
<tr class="separator:a369e92f3f8ffc2042e061bd2a64a0f8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a9b72d0dadaea32fec8d4ff1c0eafa4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a5a9b72d0dadaea32fec8d4ff1c0eafa4">Task_Next</a> ()</td></tr>
<tr class="memdesc:a5a9b72d0dadaea32fec8d4ff1c0eafa4"><td class="mdescLeft">&#160;</td><td class="mdescRight">The calling task gives up its share of the processor voluntarily.  <a href="#a5a9b72d0dadaea32fec8d4ff1c0eafa4">More...</a><br /></td></tr>
<tr class="separator:a5a9b72d0dadaea32fec8d4ff1c0eafa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a266ddbe2a3ded7e68eaa0d68a4047387"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#a266ddbe2a3ded7e68eaa0d68a4047387">Task_Terminate</a> ()</td></tr>
<tr class="memdesc:a266ddbe2a3ded7e68eaa0d68a4047387"><td class="mdescLeft">&#160;</td><td class="mdescRight">The calling task terminates itself.  <a href="#a266ddbe2a3ded7e68eaa0d68a4047387">More...</a><br /></td></tr>
<tr class="separator:a266ddbe2a3ded7e68eaa0d68a4047387"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc48a5ac983c4656508f39c0ee65283f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#adc48a5ac983c4656508f39c0ee65283f">Task_GetArg</a> (void)</td></tr>
<tr class="memdesc:adc48a5ac983c4656508f39c0ee65283f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the assigned parameter.  <a href="#adc48a5ac983c4656508f39c0ee65283f">More...</a><br /></td></tr>
<tr class="separator:adc48a5ac983c4656508f39c0ee65283f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dea/os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr class="separator:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A Real Time Operating System. </p>
<p>Our implementation of the operating system described by Mantis Cheng in <a class="el" href="../../d0/dff/os_8h.html" title="A simple RTOS interface. ">os.h</a>.</p>
<dl class="section author"><dt>Author</dt><dd>Scott Craig </dd>
<dd>
Justin Tanner </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a4ca901a3c767870093be57d271afc51e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KERNELARG_STACKOFFSET&#160;&#160;&#160;(32 + 1 + 1 + 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa48fc0927da8c8abbe88e67573b389c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RESTORE_CTX</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="../../d7/dea/os_8c.html#a6002f8099b24e6c7903df21a754f1d6b">RESTORE_CTX_BOTTOM</a>();<a class="el" href="../../d7/dea/os_8c.html#ac79aff233b9171c3cacaf6ddffe8014a">RESTORE_CTX_TOP</a>();</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pop all registers and the status register. </p>

</div>
</div>
<a class="anchor" id="a6002f8099b24e6c7903df21a754f1d6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RESTORE_CTX_BOTTOM</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac79aff233b9171c3cacaf6ddffe8014a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RESTORE_CTX_TOP</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">asm</span> <span class="keyword">volatile</span> (\</div>
<div class="line">    <span class="stringliteral">&quot;pop    r31             \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;out    __SREG__, r31   \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;pop    r31             \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;out    0X3C, r31       \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;pop    r31             \n\t&quot;</span>::);</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad70a92eee8278b45f6aad877e23e0d3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SAVE_CTX</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="../../d7/dea/os_8c.html#ac8ed78dfc7cf1438e51909e988a8e6aa">SAVE_CTX_TOP</a>();<a class="el" href="../../d7/dea/os_8c.html#a9250d18ad0a0ff5171eed2dc5f4e18d4">SAVE_CTX_BOTTOM</a>();</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Push all the registers and SREG onto the stack. </p>

</div>
</div>
<a class="anchor" id="a9250d18ad0a0ff5171eed2dc5f4e18d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SAVE_CTX_BOTTOM</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac8ed78dfc7cf1438e51909e988a8e6aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SAVE_CTX_TOP</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">asm</span> <span class="keyword">volatile</span> (\</div>
<div class="line">    <span class="stringliteral">&quot;push   r31             \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;in     r31,0X3C        \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;push   r31             \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;in     r31,__SREG__    \n\t&quot;</span>\</div>
<div class="line">    <span class="stringliteral">&quot;cli                    \n\t&quot;</span>::); <span class="comment">/* Disable interrupt */</span></div>
</div><!-- fragment --><p>It is important to keep the order of context saving and restoring exactly in reverse. Also, when a new task is created, it is important to initialize its "initial" context in the same order as a saved context.</p>
<p>Save r31 and SREG on stack, disable interrupts, then save the rest of the registers on the stack. In the locations this macro is used, the interrupts need to be disabled, or they already are disabled. </p>

</div>
</div>
<a class="anchor" id="adadefdf0cfb4066c6439cd200093c456"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STACK_SREG_SET_I_BIT</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">asm</span> <span class="keyword">volatile</span> (\</div>
<div class="line">    <span class="stringliteral">&quot;ori    r31, 0x80        \n\t&quot;</span>::);</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adc80b18f37f24eb0f8bc27ca56e65d4b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STACKCONTEXTSIZE&#160;&#160;&#160;(32 + 1 + 1 + 3 + 3)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a13f1ce8d1aeefce0b0d42cc7bad81fa1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define USE_AVR2560_GREATER&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ae66f6b31b5ad750f1fe042a706a4e3d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Runtime entry point into the program; just start the RTOS. The application layer must define <a class="el" href="../../d7/dea/os_8c.html#afff05d20e8e3bfc1d7d8aab2bb3a1e9b" title="main function provided by user application. The first task to run. ">r_main()</a> for its entry point. </p>

</div>
</div>
<a class="anchor" id="af421581f2b3d36a5ac9a205e035ae172"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t Now </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>return time since operation began in millis. </p>

</div>
</div>
<a class="anchor" id="ab5747390a8be675282cb93e5198bd085"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OS_Abort </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Abort the execution of this RTOS due to an unrecoverable erorr. </p>
<p>Initialize this RTOS; the standard default "main()" is defined inside <a class="el" href="../../d7/dea/os_8c.html" title="A Real Time Operating System. ">os.c</a>, which is essentially <a class="el" href="../../d7/dea/os_8c.html#a280149a9407c6504ce0af541351561db" title="Setup the RTOS and create main() as the first SYSTEM level task. ">OS_Init()</a>. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="../../index.html#boot">OS BOOTING</a>.</dd></dl>
<p>void <a class="el" href="../../d7/dea/os_8c.html#a280149a9407c6504ce0af541351561db" title="Setup the RTOS and create main() as the first SYSTEM level task. ">OS_Init(void)</a>; Abort the execution of this RTOS due to an unrecoverable error. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="../../index.html#assumptions">GLOBAL ASSUMPTIONS</a>. </dd></dl>

</div>
</div>
<a class="anchor" id="a280149a9407c6504ce0af541351561db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void OS_Init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup the RTOS and create <a class="el" href="../../d7/dea/os_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a> as the first SYSTEM level task. </p>
<p>Point of entry from the C runtime crt0.S. </p>

</div>
</div>
<a class="anchor" id="afff05d20e8e3bfc1d7d8aab2bb3a1e9b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int r_main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>main function provided by user application. The first task to run. </p>
<p>RTOS initialization function.</p>
<p>Setup function called by the RTOS on initialization. </p>

</div>
</div>
<a class="anchor" id="a1b0393958dca633b459633385794d39b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/dff/os_8h.html#a26849fee1aa8a05562ee7a577e991fc8">service_t</a>* Service_Init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>a non-NULL service_t descriptor if successful; NULL otherwise.</dd></dl>
<p>Initialize a new, non-NULL service_t descriptor. </p>

</div>
</div>
<a class="anchor" id="aaa4dbf5e4da2f0aba1fff3b057e79389"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Service_Publish </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/dff/os_8h.html#a26849fee1aa8a05562ee7a577e991fc8">service_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>a Service descriptor</td></tr>
  </table>
  </dd>
</dl>
<p>The calling task publishes a new value "v" to service "s". All waiting tasks on service "s" will be resumed and receive a copy of this value "v". Values generated by services without subscribers will be lost. </p>

</div>
</div>
<a class="anchor" id="aee597502c326bc9ca1faeaa422dbbbf8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Service_Subscribe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/dff/os_8h.html#a26849fee1aa8a05562ee7a577e991fc8">service_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>an Service descriptor </td></tr>
    <tr><td class="paramname">v</td><td>pointer to memory where the received value will be written</td></tr>
  </table>
  </dd>
</dl>
<p>The calling task waits for the next published value associated with service "s". More than one task may wait for a service. When a new value "v" is published to "s", all waiting tasks resume and obtain the same value. </p>

</div>
</div>
<a class="anchor" id="a369e92f3f8ffc2042e061bd2a64a0f8f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t Task_Create_Periodic </td>
          <td>(</td>
          <td class="paramtype">void(*)(void)&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>wcet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>start</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>a parameterless function to be created as a process instance </td></tr>
    <tr><td class="paramname">arg</td><td>an integer argument to be assigned to this process instanace </td></tr>
    <tr><td class="paramname">period</td><td>its execution period in TICKs </td></tr>
    <tr><td class="paramname">wcet</td><td>its worst-case execution time in TICKs, must be less than "period" </td></tr>
    <tr><td class="paramname">start</td><td>its start time in TICKs </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if not successful; otherwise non-zero. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d0/dff/os_8h.html#a91fbf56e495523d9ef99a4c71400b664" title="Retrieve the assigned parameter. ">Task_GetArg()</a></dd></dl>
<p>A new process is created to execute the parameterless function <em>f</em> with an initial parameter <em>arg</em>, which is retrieved by a call to <a class="el" href="../../d0/dff/os_8h.html#a91fbf56e495523d9ef99a4c71400b664" title="Retrieve the assigned parameter. ">Task_GetArg()</a>. If a new process cannot be created, 0 is returned; otherwise, it returns non-zero.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../index.html#policy">SCHEDULING POLICY</a> </dd></dl>

</div>
</div>
<a class="anchor" id="abfffed5dc80a63a8436cc49d61e92cb7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t Task_Create_RR </td>
          <td>(</td>
          <td class="paramtype">void(*)(void)&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a2dc6b10ee85f46900bc8ed99225f4425"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t Task_Create_System </td>
          <td>(</td>
          <td class="paramtype">void(*)(void)&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>a parameterless function to be created as a process instance </td></tr>
    <tr><td class="paramname">arg</td><td>an integer argument to be assigned to this process instanace </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if not successful; otherwise non-zero. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d0/dff/os_8h.html#a91fbf56e495523d9ef99a4c71400b664" title="Retrieve the assigned parameter. ">Task_GetArg()</a></dd></dl>
<p>A new process is created to execute the parameterless function <em>f</em> with an initial parameter <em>arg</em>, which is retrieved by a call to <a class="el" href="../../d0/dff/os_8h.html#a91fbf56e495523d9ef99a4c71400b664" title="Retrieve the assigned parameter. ">Task_GetArg()</a>. If a new process cannot be created, 0 is returned; otherwise, it returns non-zero.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../index.html#policy">SCHEDULING POLICY</a> </dd></dl>

</div>
</div>
<a class="anchor" id="adc48a5ac983c4656508f39c0ee65283f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Task_GetArg </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the assigned parameter. </p>
<p>Retrieve the assigned parameter. </p><dl class="section see"><dt>See also</dt><dd>Task_Create(). </dd></dl>

</div>
</div>
<a class="anchor" id="a5a9b72d0dadaea32fec8d4ff1c0eafa4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Task_Next </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The calling task gives up its share of the processor voluntarily. </p>
<p>Voluntarily relinquish the processor. </p>

</div>
</div>
<a class="anchor" id="a266ddbe2a3ded7e68eaa0d68a4047387"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Task_Terminate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The calling task terminates itself. </p>
<p>Terminate the calling process</p>
<p>When a process returns, i.e., it executes its last instruction in the associated function/code, it is automatically terminated. </p>

</div>
</div>
<a class="anchor" id="aa5bea28826fceb06503c295132d2ac03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TIMER1_COMPA_vect </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The interrupt handler for output compare interrupts on Timer 1. </p>
<p>Used to enter the kernel when a tick expires.</p>
<p>Assumption: We are still executing on the cur_task stack. The return address inside the current task code is on the top of the stack.</p>
<p>The "naked" attribute prevents the compiler from adding instructions to save and restore register values. It also prevents an automatic return instruction. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_da9b1fa3a11988e83c393c7410ee9ef9.html">rtos</a></li><li class="navelem"><a class="el" href="../../d7/dea/os_8c.html">os.c</a></li>
    <li class="footer">Generated on Mon Apr 6 2015 19:06:58 for Cops vs Robbers by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
